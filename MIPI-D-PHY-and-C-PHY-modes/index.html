<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.0.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/ico32x32.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/ico16x16.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Liu Jian Mao Cao:300,300italic,400,400italic,700,700italic|Shadows Into Light:300,300italic,400,400italic,700,700italic|Yeon Sung:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Mist",version:"7.5.0",exturl:!1,sidebar:{position:"left",width:300,display:"hide",offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"Copy",copy_success:"Copied",copy_failure:"Copy failed"},sidebarPadding:40}</script><meta name="description" content="这里来看一下C-PHY和D-PHY的操作模式。"><meta name="keywords" content="D-PHY"><meta property="og:type" content="article"><meta property="og:title" content="MIPI - D-PHY and C-PHY modes"><meta property="og:url" content="http:&#x2F;&#x2F;winter-leaf.github.io&#x2F;MIPI-D-PHY-and-C-PHY-modes&#x2F;index.html"><meta property="og:site_name" content="Leaf in winter"><meta property="og:description" content="这里来看一下C-PHY和D-PHY的操作模式。"><meta property="og:locale" content="en"><meta property="og:image" content="http:&#x2F;&#x2F;winter-leaf.github.io&#x2F;MIPI-D-PHY-and-C-PHY-modes&#x2F;dphy_line_st.png"><meta property="og:image" content="http:&#x2F;&#x2F;winter-leaf.github.io&#x2F;MIPI-D-PHY-and-C-PHY-modes&#x2F;dphy_escape_comd.png"><meta property="og:image" content="http:&#x2F;&#x2F;winter-leaf.github.io&#x2F;MIPI-D-PHY-and-C-PHY-modes&#x2F;dphy_space_1_hot.png"><meta property="og:image" content="http:&#x2F;&#x2F;winter-leaf.github.io&#x2F;MIPI-D-PHY-and-C-PHY-modes&#x2F;cphy_line_st.png"><meta property="og:image" content="http:&#x2F;&#x2F;winter-leaf.github.io&#x2F;MIPI-D-PHY-and-C-PHY-modes&#x2F;cphy_seq.png"><meta property="og:updated_time" content="2020-06-07T12:57:07.219Z"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http:&#x2F;&#x2F;winter-leaf.github.io&#x2F;MIPI-D-PHY-and-C-PHY-modes&#x2F;dphy_line_st.png"><link rel="canonical" href="http://winter-leaf.github.io/MIPI-D-PHY-and-C-PHY-modes/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>MIPI - D-PHY and C-PHY modes | Leaf in winter</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Leaf in winter</span><span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">Do you see the wind?</h1></div><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i> Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i> Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i> Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i> Archives</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> Search</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"> <input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Searching..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content"><div class="posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="http://winter-leaf.github.io/MIPI-D-PHY-and-C-PHY-modes/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpeg"><meta itemprop="name" content="winter leaf"><meta itemprop="description" content="Batman, if you don't believe it then superman"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Leaf in winter"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"> MIPI - D-PHY and C-PHY modes</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2020-06-07 14:51:50 / Modified: 14:57:07" itemprop="dateCreated datePublished" datetime="2020-06-07T14:51:50+02:00">2020-06-07</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/MIPI/" itemprop="url" rel="index"><span itemprop="name">MIPI</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>这里来看一下C-PHY和D-PHY的操作模式。</p><a id="more"></a><h1 id="1-C-PHY和D-PHY的总体工作过程"><a href="#1-C-PHY和D-PHY的总体工作过程" class="headerlink" title="1. C-PHY和D-PHY的总体工作过程"></a>1. C-PHY和D-PHY的总体工作过程</h1><pre><code>C- PHY和D-PHY，后续统称PHY，都是有不同的电平等级的物理层协议。从逻辑作用上看:</code></pre><ul><li>低电平用于数据传输，称作High-Speed(HS)模式</li><li>高电平用于切换工作模式，称作Low-Power(LP)模式</li></ul><p>一般情况下，在没有传输活动或闲置时，PHY会停留在LP模式下。<br>以数据发送为例，一旦有活动，PHY会先在LP模式下，在发送端和接收端之间通过data lane发送一连串逻辑值序列以切换两端的工作模式和电平等级到HS。紧接着发送相关数据。数据发送完后再切换回LP模式。</p><p>HS和LP有不同的逻辑值表示方式，称作Lane state。C-PHY的HS模式下，Lane state就是wire-state。</p><h1 id="2-Lane-State"><a href="#2-Lane-State" class="headerlink" title="2. Lane State"></a>2. Lane State</h1><p>Lane state指在High-Speed(HS)和Low-Power(LP)这两种电平操作模式下data lane上的状态。</p><ul><li>C-PHY的data lane有A，B，C三根线。</li><li>D-PHY的data lane有dn，dp两根线。</li></ul><h2 id="2-1-D-PHY-lane-state"><a href="#2-1-D-PHY-lane-state" class="headerlink" title="2.1 D-PHY lane state"></a>2.1 D-PHY lane state</h2><p>HS模式下，data lane会以低电平变化来传输数据。由于D-PHY使用差分信号，并且dp和dn是由同一个高速发送器(HS-TX)同时差分驱动，逻辑值0，1会以dp与dn的差值来表示，即dp和dn不会在同一电平值上。那么dp与dn只剩两种组合，dp&lt;dn和dp&gt;dn，分别表示状态HS-0，HS-1，用于表示数据。</p><p>LP模式下，dp和dn由两个单独的低压发送器(LP-TX)独立发送，那么dp与dn就会有四种组合，逻辑值依次为LP-00，LP-01，LP-10，LP-11，用于表示模式切换。</p><p>具体可以总结为下表<br><img src="dphy_line_st.png" alt="dphy_line_st"></p><p>HS和LP模式下，dp和dn的电平等级是不同的，这在介绍D-PHY的文章里提到过。LP模式的电平等级和幅度会高一些。</p><p>上面表格中，在High-Speed和Low-Power下对应的内容为当前Lane state的作用。<br>可以看到，在High-Speed下HS-0，HS-1只用来表示逻辑值0，1。<br>在Low-Power下，又细分了两个不同的模式，Control和Escape。这些模式的切换会用到不同的逻辑值序列，这里不对它们一一的介绍，但会看一些例子来了解它们是怎么工作的，并介绍一下其中用到的Spaced-One-Hot编码方式。</p><h3 id="2-1-1-D-PHY操作模式及切换方法举例"><a href="#2-1-1-D-PHY操作模式及切换方法举例" class="headerlink" title="2.1.1 D-PHY操作模式及切换方法举例"></a>2.1.1 D-PHY操作模式及切换方法举例</h3><p>在没有活动的时候，D-PHY都会维持在Stop state(LP-11)。<br>经由不同的Sequence，D-PHY会进入不同的操作模式下。<br>这个从闲置到切换的过程，D-PHY是处于Low-Power Control Mode下。</p><h4 id="2-1-1-1-Control-mode-switch-to-HS-mode"><a href="#2-1-1-1-Control-mode-switch-to-HS-mode" class="headerlink" title="2.1.1.1 Control mode switch to HS mode"></a>2.1.1.1 Control mode switch to HS mode</h4><p>进入HS模式会用到Start-of-Transmision Sequence。<br>Start-of-Transmision Sequence的发送步骤是:<br>In Control mode -&gt; Stop state(LP11) -&gt; HS-Req state(LP01) -&gt; Bridge state(LP00) -&gt; 此时进入了HS模式 -&gt; 发送 HS-0 一段时间 -&gt; 在HS模式下发送entry code = ”00011101” -&gt; 开始HS模式下正常发送目标数据</p><p>从步骤上我们可以看出，它经历了由LP到HS的切换，并且在正式发送数据前还要发送一个规定的8位的起始序列”00011101”。</p><h4 id="2-1-1-2-Control-mode-switch-to-Escape-mode"><a href="#2-1-1-2-Control-mode-switch-to-Escape-mode" class="headerlink" title="2.1.1.2 Control mode switch to Escape mode"></a>2.1.1.2 Control mode switch to Escape mode</h4><p>进入步骤是:<br>In Control mode -&gt; Stop state(LP-11) -&gt; Spaced-One-Hot Encoding Mark-1(LP-10) -&gt; Space State(LP-00) -&gt; Spaced-One-Hot Encoding Mark-0(LP-01) -&gt; Space state(LP-00) -&gt; 此时进入了Escape模式</p><p>进入Escape模式的过程和进入HS模式类似，只不过我们不用切换电平等级，也没有多余的entry code。<br>但是在进入Escape模式下后，Escape的通信会使用一种特殊的编码方式Spaced-One-Hot。</p><h4 id="2-1-1-3-Spaced-One-Hot-Encoding"><a href="#2-1-1-3-Spaced-One-Hot-Encoding" class="headerlink" title="2.1.1.3 Spaced-One-Hot Encoding"></a>2.1.1.3 Spaced-One-Hot Encoding</h4><p>Escape模式是PHY用来处理LP模式下附加指令的一个操作模式。<br>这些附加指令会以LP模式的lane state，经由Spaced-One-Hot编码来发送。<br>Spaced-One-Hot编码的方式为:<br> 1. 指令序列可以有n位逻辑值<br> 2. 逻辑值具体由Marker-0，Marker-1来表示<br> 3. 两Marker之间必须有Space位<br> 4. 指令序列的以非指令内容的Marker-1 + Stop位来表示<br> 5. 没有同步时钟，以Marker + Space作为一周期<br>Escape模式下支持的指令有:<br><img src="dphy_escape_comd.png" alt="dphy_escape_comd"></p><p>拿Reset-Trigger这条指令来说，它有8位逻辑值01100010，对应图像为:<br><img src="dphy_space_1_hot.png" alt="dphy_space_1_hot"></p><p>图中红黑线之间为原本PHY使用的一个时钟周期。<br>在开头部分，先进入了Escape模式。之后开始发送Reset-Trigger指令(01100010)，这里的Spaced-One-Hot编码方式由于Space的加入会和对应的Marker一起在时间上占用两个周期来发送一位逻辑值。</p><h1 id="2-2-C-PHY-lane-state"><a href="#2-2-C-PHY-lane-state" class="headerlink" title="2.2 C-PHY lane state"></a>2.2 C-PHY lane state</h1><p>理解了D-PHY之后，C-PHY就相对容易了。<br>C-PHY的lane state和D-PHY的格式类似，只不过从两个线dp，dn变成了三根线A，B，C。<br><img src="cphy_line_st.png" alt="cphy_line_st"></p><p>这里LP模式下只有4种状态而不是8种是为了和D-PHY的LP状态数一致，保持兼容性。</p><h3 id="2-2-1-C-PHY操作模式及切换方法举例"><a href="#2-2-1-C-PHY操作模式及切换方法举例" class="headerlink" title="2.2.1 C-PHY操作模式及切换方法举例"></a>2.2.1 C-PHY操作模式及切换方法举例</h3><p>这里还是举几个例子。</p><h4 id="2-2-1-1-Control-mode-switch-to-HS-mode"><a href="#2-2-1-1-Control-mode-switch-to-HS-mode" class="headerlink" title="2.2.1.1 Control mode switch to HS mode"></a>2.2.1.1 Control mode switch to HS mode</h4><p>进入HS模式会用到Start-of-Transmision Sequence:<br>In Control Mode -&gt; Stop state(LP-111) -&gt; HS request(LP-001) -&gt; LP request(LP-100) -&gt; 进入HS模式 -&gt; 发送Preamble sequence -&gt; 发送Sync Word Sequence -&gt; 开始发送目标数据</p><h4 id="2-2-1-2-HS-mode-switch-to-Control-mode"><a href="#2-2-1-2-HS-mode-switch-to-Control-mode" class="headerlink" title="2.2.1.2 HS mode switch to Control mode"></a>2.2.1.2 HS mode switch to Control mode</h4><p>离开HS模式会End-of-Transmision Sequence:<br>In HS Mode -&gt; 发送完成目标数据 -&gt; 发送Post Sequence -&gt; 进入LP模式Control Mode -&gt; Stop state(LP-111)</p><h4 id="2-2-1-3-Sequences"><a href="#2-2-1-3-Sequences" class="headerlink" title="2.2.1.3 Sequences"></a>2.2.1.3 Sequences</h4><p>这里的Preamble sequence和Sync Word Sequence都是一串连续的symbol序列。除这两个外还有Programmable Sequence和Post Sequence等其他symbol序列。</p><p>在介绍C-PHY 编码的文章中提到过，symbol的编码表示空间要比原始16-bit的数据的表示空间大得多，有很多编码值是没用到的。这些没用到的编码就会在这些sequence中使用到。</p><p>比如Preamble sequence，它的形式是: 在t_3-preamble时间内连续发送重复symbo- 3(011)。<br>t_3-preamble是一个规定的时间长度。Preamble sequence还可以穿插Programmable Sequence。Programmable Sequence是一个由14个symbol组成的序列。</p><p>对应的，Post Sequence是在t_3-poSt时间内连续发送重复symbo- 4(100)。<br>t_3-post也是一个规定的时间长度。</p><p>再比如Sync Word Sequence，它的形式是7个symbol: 3,4,4,4,4,4,3。</p><p>Preamble Sequence的例子可以参照下图<br><img src="cphy_seq.png" alt="cphy_seq"></p><h1 id="3-小结"><a href="#3-小结" class="headerlink" title="3. 小结"></a>3. 小结</h1><p>为了基本了解PHY的工作步骤，本文介绍了PHY的工作模式和模式切换情况，并介绍了Spaced-One-Hot编码形式。整体来看，C-PHY和D-PHY工作模式基本相同，但区别是电平等级，导线数量和对应的模式切换序列。</p></div><div><ul class="post-copyright"><li class="post-copyright-author"> <strong>Post author:</strong> winter leaf</li><li class="post-copyright-link"> <strong>Post link:</strong> <a href="http://winter-leaf.github.io/MIPI-D-PHY-and-C-PHY-modes/" title="MIPI - D-PHY and C-PHY modes">http://winter-leaf.github.io/MIPI-D-PHY-and-C-PHY-modes/</a></li><li class="post-copyright-license"> <strong>Copyright Notice:</strong> All articles in this blog are licensed under<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i> BY-NC-SA</a> unless stating additionally. Please indicate the source when reproduce.</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/D-PHY/" rel="tag"># D-PHY</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/MIPI-D-PHY/" rel="next" title="MIPI - D-PHY"><i class="fa fa-chevron-left"></i> MIPI - D-PHY</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"></div></div></footer></article></div></div></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> Table of Contents</li><li class="sidebar-nav-overview"> Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-C-PHY和D-PHY的总体工作过程"><span class="nav-text">1. C-PHY和D-PHY的总体工作过程</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-Lane-State"><span class="nav-text">2. Lane State</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-D-PHY-lane-state"><span class="nav-text">2.1 D-PHY lane state</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1-D-PHY操作模式及切换方法举例"><span class="nav-text">2.1.1 D-PHY操作模式及切换方法举例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-1-Control-mode-switch-to-HS-mode"><span class="nav-text">2.1.1.1 Control mode switch to HS mode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-2-Control-mode-switch-to-Escape-mode"><span class="nav-text">2.1.1.2 Control mode switch to Escape mode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-3-Spaced-One-Hot-Encoding"><span class="nav-text">2.1.1.3 Spaced-One-Hot Encoding</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-2-C-PHY-lane-state"><span class="nav-text">2.2 C-PHY lane state</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-C-PHY操作模式及切换方法举例"><span class="nav-text">2.2.1 C-PHY操作模式及切换方法举例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-1-Control-mode-switch-to-HS-mode"><span class="nav-text">2.2.1.1 Control mode switch to HS mode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-2-HS-mode-switch-to-Control-mode"><span class="nav-text">2.2.1.2 HS mode switch to Control mode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-3-Sequences"><span class="nav-text">2.2.1.3 Sequences</span></a></li></ol></li></ol></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#3-小结"><span class="nav-text">3. 小结</span></a></li></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="winter leaf" src="/images/avatar.jpeg"><p class="site-author-name" itemprop="name">winter leaf</p><div class="site-description" itemprop="description">Batman, if you don't believe it then superman</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">27</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"> <span class="site-state-item-count">9</span> <span class="site-state-item-name">categories</span></div><div class="site-state-item site-state-tags"> <span class="site-state-item-count">13</span> <span class="site-state-item-name">tags</span></div></nav></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2020</span><span class="with-love"><i class="fa fa-gamepad"></i></span> <span class="author" itemprop="copyrightHolder">winter leaf</span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>